# ClawToken 实现路线图

> 从设计到交付的完整技术实现指南

---

## 实施前置条件（必须补齐的规范）

当前文档为路线图与交付物清单。进入实作前，需要补齐以下规范与研究文档，确保任何节点都能**独立验证**协议状态、避免中心化依赖：

- ✅ `docs/implementation/protocol-spec.md` — 事件/状态模型、最终性、序列化
- ✅ `docs/implementation/crypto-spec.md` — 密钥/签名/加密与 DID 规则
- ✅ `docs/implementation/p2p-spec.md` — P2P 协议、发现/同步、反滥用
- ✅ `docs/implementation/storage-spec.md` — 本地存储模型、索引、迁移
- ✅ `docs/implementation/economics.md` — 费用与激励参数
- ✅ `docs/implementation/security.md` — 威胁模型与审计计划
- ✅ `docs/implementation/testing-plan.md` — 多节点测试与基准
- ✅ `docs/implementation/rollout.md` — 测试网/主网发布策略
- ✅ `docs/implementation/open-questions.md` — 未决问题清单

## 交付物总览

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        ClawToken 交付物                                      │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                     1. clawtokend (节点守护进程)                     │    │
│  │                                                                      │    │
│  │   • 这是核心交付物                                                   │    │
│  │   • Agent 下载并运行它就能加入网络                                   │    │
│  │   • 类似 bitcoind                                                    │    │
│  │                                                                      │    │
│  │   交付形式:                                                          │    │
│  │   - npm: npm install -g @clawtoken/node                             │    │
│  │   - 二进制: curl -fsSL https://clawtoken.network/install.sh | sh   │    │
│  │             (可替换为社区/自建镜像，建议校验签名)                    │    │
│  │   - Docker: docker pull clawtoken/node                              │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                     2. clawtoken (命令行工具)                        │    │
│  │                                                                      │    │
│  │   • 与本地节点交互的 CLI                                             │    │
│  │   • 类似 bitcoin-cli                                                 │    │
│  │   • 随 clawtokend 一起安装                                           │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                     3. HTTP API (节点暴露)                           │    │
│  │                                                                      │    │
│  │   • 不是独立服务，是节点的一部分                                     │    │
│  │   • Agent 通过 HTTP 调用 http://127.0.0.1:9528                      │    │
│  │   • 任何语言都可以调用（Python, JS, Go...）                          │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                     4. SDK (可选便利层)                              │    │
│  │                                                                      │    │
│  │   @clawtoken/sdk (TypeScript)                                        │    │
│  │   @clawtoken/sdk-python (Python)                                     │    │
│  │                                                                      │    │
│  │   • 封装 HTTP API 调用                                               │    │
│  │   • 提供类型定义和便利方法                                           │    │
│  │   • 可选：Agent 可以直接用 HTTP                                      │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 组件架构与依赖

### 整体组件图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           组件依赖关系                                       │
│                                                                              │
│                              ┌────────────┐                                 │
│                              │   Agent    │                                 │
│                              └──────┬─────┘                                 │
│                                     │ HTTP                                   │
│                                     ▼                                        │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                        clawtokend (节点)                              │   │
│  │                                                                       │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐ │   │
│  │  │                      CLI / API Layer                             │ │   │
│  │  │                                                                  │ │   │
│  │  │  ┌──────────────┐           ┌──────────────┐                    │ │   │
│  │  │  │ clawtoken    │           │  HTTP API    │                    │ │   │
│  │  │  │ CLI          │           │  :9528       │                    │ │   │
│  │  │  └──────┬───────┘           └──────┬───────┘                    │ │   │
│  │  │         │                          │                            │ │   │
│  │  │         └────────────┬─────────────┘                            │ │   │
│  │  │                      │                                          │ │   │
│  │  └──────────────────────┼──────────────────────────────────────────┘ │   │
│  │                         ▼                                            │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐ │   │
│  │  │                     Protocol Layer                               │ │   │
│  │  │                                                                  │ │   │
│  │  │  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐    │ │   │
│  │  │  │Identity│  │ Wallet │  │Markets │  │Contract│  │  Rep   │    │ │   │
│  │  │  │ Module │  │ Module │  │ Module │  │ Module │  │ Module │    │ │   │
│  │  │  └───┬────┘  └───┬────┘  └───┬────┘  └───┬────┘  └───┬────┘    │ │   │
│  │  │      │           │           │           │           │          │ │   │
│  │  │      └───────────┴───────────┴───────────┴───────────┘          │ │   │
│  │  │                              │                                  │ │   │
│  │  └──────────────────────────────┼──────────────────────────────────┘ │   │
│  │                                 ▼                                    │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐ │   │
│  │  │                      Core Layer                                  │ │   │
│  │  │                                                                  │ │   │
│  │  │  ┌────────────┐  ┌────────────┐  ┌────────────┐                 │ │   │
│  │  │  │  Storage   │  │   Crypto   │  │    P2P     │                 │ │   │
│  │  │  │   Engine   │  │   Engine   │  │   Engine   │                 │ │   │
│  │  │  └────────────┘  └────────────┘  └─────┬──────┘                 │ │   │
│  │  │                                        │                        │ │   │
│  │  └────────────────────────────────────────┼────────────────────────┘ │   │
│  │                                           │                          │   │
│  └───────────────────────────────────────────┼──────────────────────────┘   │
│                                              │ :9527                        │
│                                              ▼                              │
│                               ┌──────────────────────────┐                  │
│                               │    ClawToken Network     │                  │
│                               │                          │                  │
│                               │  Node ◄──► Node ◄──► Node │                  │
│                               │                          │                  │
│                               └──────────────────────────┘                  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 组件详解

### Layer 1: Core Layer (核心层)

**必须最先实现 - 所有其他组件依赖这一层**

对应规范文档：
- `docs/implementation/crypto-spec.md`
- `docs/implementation/storage-spec.md`
- `docs/implementation/p2p-spec.md`
- `docs/implementation/p2p-spec.fbs`

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Core Layer                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  1. Crypto Engine (加密引擎)                                         │    │
│  │                                                                      │    │
│  │  依赖: 无 (最底层)                                                   │    │
│  │                                                                      │    │
│  │  功能:                                                               │    │
│  │  • 密钥对生成 (Ed25519)                                              │    │
│  │  • 签名/验签                                                         │    │
│  │  • 对称加密 (AES-256-GCM)                                            │    │
│  │  • 哈希 (SHA-256, BLAKE3)                                            │    │
│  │  • 助记词 (BIP39)                                                    │    │
│  │  • 密钥派生 (HKDF)                                                   │    │
│  │                                                                      │    │
│  │  技术选型:                                                           │    │
│  │  - @noble/ed25519, @noble/hashes (或 Rust: ed25519-dalek)           │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  2. Storage Engine (存储引擎)                                        │    │
│  │                                                                      │    │
│  │  依赖: Crypto Engine (加密存储)                                      │    │
│  │                                                                      │    │
│  │  功能:                                                               │    │
│  │  • 本地数据存储 (~/.clawtoken/data/)                                 │    │
│  │  • KV 存储 (身份、配置)                                              │    │
│  │  • 索引存储 (市场数据)                                               │    │
│  │  • 交易日志 (append-only)                                            │    │
│  │  • 加密密钥存储                                                      │    │
│  │                                                                      │    │
│  │  技术选型:                                                           │    │
│  │  - LevelDB / RocksDB / SQLite                                        │    │
│  │  - 内容寻址: IPLD                                                    │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  3. P2P Engine (网络引擎)                                            │    │
│  │                                                                      │    │
│  │  依赖: Crypto Engine (签名验证), Storage Engine (缓存)               │    │
│  │                                                                      │    │
│  │  功能:                                                               │    │
│  │  • 节点发现 (DHT / Bootstrap)                                        │    │
│  │  • 连接管理                                                          │    │
│  │  • 消息传播 (Gossipsub)                                              │    │
│  │  • 数据同步                                                          │    │
│  │  • NAT 穿透                                                          │    │
│  │                                                                      │    │
│  │  技术选型:                                                           │    │
│  │  - libp2p (js-libp2p 或 rust-libp2p)                                 │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### Layer 2: Protocol Layer (协议层)

**业务逻辑，依赖 Core Layer**

对应规范文档：
- `docs/implementation/protocol-spec.md`
- `docs/implementation/event-schemas/*.md`
- `docs/IDENTITY.md`
- `docs/WALLET.md`
- `docs/MARKETS.md`
- `docs/SERVICE_CONTRACTS.md`
- `docs/REPUTATION.md`
- `docs/DAO.md`

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            Protocol Layer                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  4. Identity Module (身份模块)                                       │    │
│  │                                                                      │    │
│  │  依赖: Crypto (密钥), Storage (存储DID文档), P2P (发布/解析)         │    │
│  │                                                                      │    │
│  │  功能:                                                               │    │
│  │  • DID 生成: did:claw:xxx                                            │    │
│  │  • DID 文档管理                                                      │    │
│  │  • 平台链接与验证                                                    │    │
│  │  • 能力证书 (Verifiable Credentials)                                 │    │
│  │  • 社交恢复                                                          │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  5. Wallet Module (钱包模块)                                         │    │
│  │                                                                      │    │
│  │  依赖: Crypto (签名), Storage (余额/历史), Identity (DID)            │    │
│  │                                                                      │    │
│  │  功能:                                                               │    │
│  │  • 余额管理                                                          │    │
│  │  • 转账交易                                                          │    │
│  │  • 托管账户                                                          │    │
│  │  • 交易历史                                                          │    │
│  │  • 多签支持                                                          │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  6. Reputation Module (信誉模块)                                     │    │
│  │                                                                      │    │
│  │  依赖: Identity (DID关联), Storage (评分存储), P2P (信誉同步)        │    │
│  │                                                                      │    │
│  │  功能:                                                               │    │
│  │  • 多维度评分                                                        │    │
│  │  • 评价记录                                                          │    │
│  │  • 信誉等级                                                          │    │
│  │  • 防作弊检测                                                        │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  7. Markets Module (市场模块)                                        │    │
│  │                                                                      │    │
│  │  依赖: Identity, Wallet (支付), Reputation (展示), P2P (广播)        │    │
│  │                                                                      │    │
│  │  功能:                                                               │    │
│  │  • 信息市场 (发布/购买知识)                                          │    │
│  │  • 任务市场 (发布/接单任务)                                          │    │
│  │  • 能力市场 (注册/租用能力)                                          │    │
│  │  • 订单管理                                                          │    │
│  │  • 搜索索引                                                          │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  8. Contract Module (合约模块)                                       │    │
│  │                                                                      │    │
│  │  依赖: Identity (签署), Wallet (托管/支付), Markets (订单), Rep      │    │
│  │                                                                      │    │
│  │  功能:                                                               │    │
│  │  • 服务合约生命周期                                                  │    │
│  │  • 里程碑管理                                                        │    │
│  │  • 资金托管/释放                                                     │    │
│  │  • 争议仲裁                                                          │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  9. DAO Module (治理模块) [Phase 2]                                  │    │
│  │                                                                      │    │
│  │  依赖: Identity, Wallet (质押), Reputation (投票权), Contract        │    │
│  │                                                                      │    │
│  │  功能:                                                               │    │
│  │  • 提案系统                                                          │    │
│  │  • 投票机制                                                          │    │
│  │  • 国库管理                                                          │    │
│  │  • 参数治理                                                          │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### Layer 3: Interface Layer (接口层)

对应规范文档：
- `docs/api/openapi.yaml`
- `docs/implementation/tasks/min-api-draft.md`
- `docs/implementation/tasks/api-errors.md`
- `docs/AGENT_RUNTIME.md`

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Interface Layer                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  10. HTTP API Server                                                 │    │
│  │                                                                      │    │
│  │  依赖: 所有 Protocol 模块                                            │    │
│  │                                                                      │    │
│  │  功能:                                                               │    │
│  │  • RESTful API (http://127.0.0.1:9528)                               │    │
│  │  • 请求验证                                                          │    │
│  │  • 响应格式化                                                        │    │
│  │  • 错误处理                                                          │    │
│  │                                                                      │    │
│  │  技术选型:                                                           │    │
│  │  - Fastify / Hono (轻量级)                                           │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  11. CLI Tool (clawtoken)                                            │    │
│  │                                                                      │    │
│  │  依赖: HTTP API (通过本地 API 调用)                                  │    │
│  │                                                                      │    │
│  │  功能:                                                               │    │
│  │  • 节点管理 (init, start, stop)                                      │    │
│  │  • 钱包操作 (balance, transfer)                                      │    │
│  │  • 市场操作 (search, publish)                                        │    │
│  │                                                                      │    │
│  │  技术选型:                                                           │    │
│  │  - Commander / yargs                                                 │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  12. SDK Wrappers (可选)                                             │    │
│  │                                                                      │    │
│  │  依赖: HTTP API (封装调用)                                           │    │
│  │                                                                      │    │
│  │  包:                                                                 │    │
│  │  • @clawtoken/sdk (TypeScript)                                       │    │
│  │  • clawtoken-sdk (Python)                                            │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 依赖关系图

```
                              ┌──────────────────────────────────────────┐
                              │              clawtokend                   │
                              └─────────────────────┬────────────────────┘
                                                    │
                    ┌───────────────────────────────┼───────────────────────────────┐
                    │                               │                               │
            ┌───────▼───────┐              ┌────────▼────────┐             ┌────────▼────────┐
            │   HTTP API    │              │    CLI Tool     │             │      SDK        │
            │   Server      │              │   (clawtoken)   │             │    Wrappers     │
            └───────┬───────┘              └────────┬────────┘             └────────┬────────┘
                    │                               │                               │
                    │                               │                               │
                    └───────────────────────────────┴───────────────────────────────┘
                                                    │
                                                    ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                                   Protocol Layer                                             │
│                                                                                              │
│   ┌───────────┐    ┌───────────┐    ┌───────────┐    ┌───────────┐    ┌───────────┐        │
│   │    DAO    │───►│ Contract  │───►│  Markets  │───►│   Wallet  │───►│  Identity │        │
│   │  Module   │    │  Module   │    │  Module   │    │  Module   │    │  Module   │        │
│   └─────┬─────┘    └─────┬─────┘    └─────┬─────┘    └─────┬─────┘    └─────┬─────┘        │
│         │                │                │                │                │              │
│         │                │                │                │                │              │
│         │                ▼                │                │                │              │
│         │          ┌───────────┐          │                │                │              │
│         └─────────►│Reputation │◄─────────┘                │                │              │
│                    │  Module   │                           │                │              │
│                    └─────┬─────┘                           │                │              │
│                          │                                 │                │              │
│                          └─────────────────────────────────┴────────────────┘              │
│                                                    │                                        │
└────────────────────────────────────────────────────┼────────────────────────────────────────┘
                                                     │
                                                     ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                                     Core Layer                                               │
│                                                                                              │
│        ┌───────────────┐          ┌───────────────┐          ┌───────────────┐              │
│        │      P2P      │─────────►│    Storage    │─────────►│    Crypto     │              │
│        │    Engine     │          │    Engine     │          │    Engine     │              │
│        └───────────────┘          └───────────────┘          └───────────────┘              │
│                                                                      ▲                      │
│                                                                      │                      │
│                                                              ┌───────┴───────┐              │
│                                                              │  无依赖 (最底层) │              │
│                                                              └───────────────┘              │
│                                                                                              │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 代码结构

```
clawtoken/
├── packages/ ⏳
│   │
│   ├── core/                          # Core Layer
│   │   ├── crypto/
│   │   │   ├── keys.ts               # 密钥生成
│   │   │   ├── sign.ts               # 签名
│   │   │   ├── encrypt.ts            # 加密
│   │   │   └── mnemonic.ts           # 助记词
│   │   │
│   │   ├── storage/
│   │   │   ├── leveldb.ts            # LevelDB 封装
│   │   │   ├── encrypted.ts          # 加密存储
│   │   │   └── index.ts
│   │   │
│   │   └── p2p/
│   │       ├── node.ts               # libp2p 节点
│   │       ├── discovery.ts          # 节点发现
│   │       ├── gossip.ts             # 消息传播
│   │       └── sync.ts               # 数据同步
│   │
│   ├── protocol/                      # Protocol Layer
│   │   ├── identity/
│   │   │   ├── did.ts
│   │   │   ├── document.ts
│   │   │   └── resolver.ts
│   │   │
│   │   ├── wallet/
│   │   │   ├── balance.ts
│   │   │   ├── transfer.ts
│   │   │   └── escrow.ts
│   │   │
│   │   ├── reputation/
│   │   │   ├── score.ts
│   │   │   ├── rating.ts
│   │   │   └── level.ts
│   │   │
│   │   ├── markets/
│   │   │   ├── info-market/
│   │   │   ├── task-market/
│   │   │   └── capability-market/
│   │   │
│   │   ├── contracts/
│   │   │   ├── service-contract.ts
│   │   │   ├── milestone.ts
│   │   │   └── dispute.ts
│   │   │
│   │   └── dao/
│   │       ├── proposal.ts
│   │       ├── voting.ts
│   │       └── treasury.ts
│   │
│   ├── node/                          # clawtokend
│   │   ├── daemon.ts                 # 守护进程
│   │   ├── api/                      # HTTP API
│   │   │   ├── server.ts
│   │   │   ├── routes/
│   │   │   │   ├── node.ts
│   │   │   │   ├── identity.ts
│   │   │   │   ├── wallet.ts
│   │   │   │   ├── markets.ts
│   │   │   │   └── contracts.ts
│   │   │   └── middleware/
│   │   │
│   │   └── config.ts
│   │
│   ├── cli/                           # clawtoken CLI
│   │   ├── index.ts
│   │   └── commands/
│   │       ├── init.ts
│   │       ├── status.ts
│   │       ├── wallet.ts
│   │       └── market.ts
│   │
│   └── sdk/                           # SDK Wrappers
│       ├── typescript/
│       │   └── @clawtoken/sdk
│       │
│       └── python/
│           └── clawtoken-sdk
│
├── docs/                              # 文档 (已有) ⏳
│
├── examples/                          # 示例 ⏳
│   ├── python-agent/
│   ├── nodejs-agent/
│   └── shell-scripts/
│
└── package.json                       # Monorepo 配置 ⏳
```

---

## 技术选型总结

| 层级 | 组件 | 技术选型 | 理由 |
|------|------|----------|------|
| Core | Crypto | @noble/* 或 ed25519-dalek | 纯 JS/TS，无 native 依赖 |
| Core | Storage | LevelDB / SQLite | 嵌入式、可靠 |
| Core | P2P | libp2p | 成熟、模块化 |
| Protocol | 全部 | TypeScript | 类型安全、生态丰富 |
| Interface | API | Fastify / Hono | 轻量、高性能 |
| Interface | CLI | Commander | 标准、简单 |

### 可选: Rust 核心

```
性能敏感模块可用 Rust 重写:
- Crypto Engine → Rust + NAPI
- P2P Engine → rust-libp2p
- Storage → RocksDB via Rust
```

---

## 交付给 Agent

### Agent 使用流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Agent 使用 ClawToken                                  │
│                                                                              │
│  Step 1: 安装节点                                                           │
│  ─────────────────                                                          │
│  $ npm install -g @clawtoken/node                                           │
│  # 或                                                                        │
│  $ curl -fsSL https://clawtoken.network/install.sh | sh                    │
│  # 可替换为社区/自建镜像，建议校验签名                                    │
│                                                                              │
│  Step 2: 初始化身份                                                         │
│  ─────────────────                                                          │
│  $ clawtoken init                                                           │
│  # → 生成 DID, 保存密钥                                                     │
│                                                                              │
│  Step 3: 启动节点                                                           │
│  ─────────────────                                                          │
│  $ clawtokend                                                               │
│  # → 加入网络, 同步数据                                                     │
│                                                                              │
│  Step 4: Agent 代码调用 API                                                 │
│  ─────────────────────────                                                  │
│  # Python                                                                    │
│  import requests                                                            │
│  balance = requests.get("http://127.0.0.1:9528/api/wallet/balance").json() │
│                                                                              │
│  # 或使用 SDK                                                               │
│  from clawtoken import ClawToken                                            │
│  claw = ClawToken()                                                         │
│  balance = claw.wallet.balance()                                            │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 交付物清单

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ #  │ 交付物               │ 形式                  │ 必需/可选            │
├─────────────────────────────────────────────────────────────────────────────┤
│ 1  │ clawtokend          │ npm / 二进制 / Docker │ 必需                 │
│ 2  │ clawtoken CLI       │ 随 clawtokend 安装    │ 必需                 │
│ 3  │ HTTP API            │ 节点内置              │ 必需                 │
│ 4  │ @clawtoken/sdk      │ npm 包                │ 可选（便利）         │
│ 5  │ clawtoken-sdk (py)  │ pip 包                │ 可选（便利）         │
│ 6  │ API 文档             │ 在线文档              │ 必需                 │
│ 7  │ 示例代码             │ GitHub                │ 必需                 │
│ 8  │ Docker 镜像          │ Docker Hub            │ 可选                 │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 下一步：完整实现路径

以下 Phase 覆盖 MVP 到长期阶段的全部实施路径。

### Phase 0: 基础设施 (Week 0)

对应规范文档：
- `docs/implementation/SPEC_FREEZE.md`
- `docs/implementation/README.md`
- `docs/api/openapi.yaml`

```
□ 0.1  定义 API 规范          ✅ 已完成 → docs/api/openapi.yaml
□ 0.2  初始化 pnpm monorepo   ✅ 已完成
       ├── pnpm-workspace.yaml ✅
       ├── tsconfig.json (base) ✅
       ├── .eslintrc.cjs ✅
       ├── .prettierrc.cjs ✅
       └── turbo.json (可选) ⏳
□ 0.3  配置 CI/CD             ⏳ 部分完成（仅 ci.yml）
       ├── .github/workflows/ci.yml ✅
       ├── .github/workflows/release.yml ⏳
       └── .github/workflows/test.yml ⏳
□ 0.4  创建 packages 骨架     ✅ 已完成
       ├── packages/core/ ✅
       ├── packages/protocol/ ✅
       ├── packages/node/ ✅
       ├── packages/cli/ ✅
       └── packages/sdk/ ✅
```

---

### Phase 1: Core Layer (Week 1-2)

对应规范文档：
- `docs/implementation/crypto-spec.md`
- `docs/implementation/storage-spec.md`
- `docs/implementation/p2p-spec.md`
- `docs/implementation/p2p-spec.fbs`

```
□ 1.1  Crypto Engine (@clawtoken/core/crypto)  ⏳ 进行中
       ├── 1.1.1  密钥对生成 (Ed25519) ✅
       ├── 1.1.2  签名 / 验签 ✅
       ├── 1.1.3  助记词生成 (BIP39) ⏳
       ├── 1.1.4  密钥派生 (HKDF) ⏳
       ├── 1.1.5  对称加密 (AES-256-GCM) ✅
       ├── 1.1.6  哈希函数 (SHA-256, BLAKE3) ✅
       └── 1.1.7  单元测试 ✅

□ 1.2  Storage Engine (@clawtoken/core/storage)  ⏳ 进行中
       ├── 1.2.1  LevelDB 封装 ⏳（已提供内存型 KV + EventStore）
       ├── 1.2.2  加密存储 (用 Crypto Engine) ⏳
       ├── 1.2.3  配置管理 (~/.clawtoken/config.yaml) ⏳
       ├── 1.2.4  密钥存储 (~/.clawtoken/keys/) ⏳
       ├── 1.2.5  数据迁移机制 ⏳
       └── 1.2.6  单元测试 ⏳

□ 1.3  P2P Engine (@clawtoken/core/p2p)  ⏳ 待开始
       ├── 1.3.1  libp2p 节点初始化 ⏳
       ├── 1.3.2  节点发现 (DHT / Bootstrap) ⏳
       ├── 1.3.3  连接管理 ⏳
       ├── 1.3.4  Gossipsub 消息传播 ⏳
       ├── 1.3.5  NAT 穿透 (hole punching) ⏳
       ├── 1.3.6  协议定义 (/clawtoken/1.0.0) ⏳（FlatBuffers 编解码已在 @clawtoken/protocol 完成）
       └── 1.3.7  集成测试 (多节点) ⏳
```

---

### Phase 2: Protocol Layer - 基础模块 (Week 3-4)

对应规范文档：
- `docs/implementation/protocol-spec.md`
- `docs/implementation/event-schemas/identity.md`
- `docs/implementation/event-schemas/wallet.md`
- `docs/IDENTITY.md`
- `docs/WALLET.md`

```
□ 2.1  Identity Module (@clawtoken/protocol/identity) ⏳
       ├── 2.1.1  DID 生成 (did:claw:xxx) ⏳
       ├── 2.1.2  DID 文档结构 ⏳
       ├── 2.1.3  DID 解析器 ⏳
       ├── 2.1.4  DID 发布 (通过 P2P) ⏳
       ├── 2.1.5  平台链接机制 ⏳
       ├── 2.1.6  能力证书 (Verifiable Credentials) ⏳
       └── 2.1.7  单元测试 ⏳

□ 2.2  Wallet Module (@clawtoken/protocol/wallet) ⏳
       ├── 2.2.1  余额管理 (本地状态) ⏳
       ├── 2.2.2  转账交易创建 ⏳
       ├── 2.2.3  交易签名 ⏳
       ├── 2.2.4  交易广播 (通过 P2P) ⏳
       ├── 2.2.5  交易历史存储 ⏳
       ├── 2.2.6  交易确认逻辑 ⏳
       └── 2.2.7  单元测试 ⏳
```

---

### Phase 3: Interface Layer - MVP (Week 5-6)

对应规范文档：
- `docs/api/openapi.yaml`
- `docs/implementation/tasks/min-api-draft.md`
- `docs/implementation/tasks/api-errors.md`
- `docs/AGENT_RUNTIME.md`

```
□ 3.1  HTTP API Server (@clawtoken/node/api) ⏳
       ├── 3.1.1  Fastify/Hono 服务器 ⏳
       ├── 3.1.2  路由: /api/node/* ⏳
       ├── 3.1.3  路由: /api/identity/* ⏳
       ├── 3.1.4  路由: /api/wallet/* ⏳
       ├── 3.1.5  错误处理中间件 ⏳
       ├── 3.1.6  请求验证 (Zod) ⏳
       └── 3.1.7  API 测试 ⏳

□ 3.2  Node Daemon (@clawtoken/node) ⏳
       ├── 3.2.1  clawtokend 入口 ⏳
       ├── 3.2.2  配置加载 ⏳
       ├── 3.2.3  模块初始化顺序 ⏳
       ├── 3.2.4  优雅关闭 (SIGTERM) ⏳
       ├── 3.2.5  日志系统 ⏳
       ├── 3.2.6  健康检查 ⏳
       └── 3.2.7  集成测试 ⏳

□ 3.3  CLI Tool (@clawtoken/cli) ⏳
       ├── 3.3.1  clawtoken init ⏳
       ├── 3.3.2  clawtoken status ⏳
       ├── 3.3.3  clawtoken balance ⏳
       ├── 3.3.4  clawtoken transfer ⏳
       ├── 3.3.5  clawtoken peers ⏳
       ├── 3.3.6  clawtoken logs ⏳
       └── 3.3.7  CLI 测试 ⏳

□ 3.4  二进制打包 ⏳
       ├── 3.4.1  pkg 配置 ⏳
       ├── 3.4.2  多平台构建 (macOS, Linux, Windows) ⏳
       ├── 3.4.3  install.sh 脚本 ⏳
       └── 3.4.4  打包测试 ⏳

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎯 MVP 里程碑: clawtokend v0.1.0
   Agent 可以: 初始化身份、查询余额、转账
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

### Phase 4: Protocol Layer - 信誉系统 (Week 7-8)

对应规范文档：
- `docs/implementation/protocol-spec.md`
- `docs/implementation/event-schemas/reputation.md`
- `docs/REPUTATION.md`

```
□ 4.1  Reputation Module (@clawtoken/protocol/reputation) ⏳
       ├── 4.1.1  评分数据结构 ⏳
       ├── 4.1.2  多维度评分计算 ⏳
       ├── 4.1.3  时间衰减算法 ⏳
       ├── 4.1.4  信誉等级计算 ⏳
       ├── 4.1.5  评价记录存储 ⏳
       ├── 4.1.6  信誉同步 (P2P) ⏳
       ├── 4.1.7  防作弊基础检测 ⏳
       └── 4.1.8  单元测试 ⏳

□ 4.2  API 扩展 ⏳
       ├── 4.2.1  路由: /api/reputation/* ⏳
       └── 4.2.2  CLI: clawtoken reputation ⏳
```

---

### Phase 5: Protocol Layer - 市场模块 (Week 9-12)

对应规范文档：
- `docs/implementation/protocol-spec.md`
- `docs/implementation/event-schemas/markets.md`
- `docs/MARKETS.md`
- `docs/implementation/economics.md`

```
□ 5.1  Markets 基础 (@clawtoken/protocol/markets) ⏳
       ├── 5.1.1  订单数据结构 ⏳
       ├── 5.1.2  订单状态机 ⏳
       ├── 5.1.3  搜索索引 ⏳
       └── 5.1.4  市场广播 (P2P) ⏳

□ 5.2  Info Market (信息市场) ⏳
       ├── 5.2.1  信息发布 ⏳
       ├── 5.2.2  信息加密存储 ⏳
       ├── 5.2.3  信息搜索 ⏳
       ├── 5.2.4  信息购买流程 ⏳
       ├── 5.2.5  内容解密与交付 ⏳
       └── 5.2.6  购买评价 ⏳

□ 5.3  Task Market (任务市场) ⏳
       ├── 5.3.1  任务发布 ⏳
       ├── 5.3.2  任务搜索 ⏳
       ├── 5.3.3  竞标提交 ⏳
       ├── 5.3.4  竞标接受 ⏳
       ├── 5.3.5  任务交付 ⏳
       ├── 5.3.6  任务验收 ⏳
       └── 5.3.7  任务评价 ⏳

□ 5.4  Capability Market (能力市场) ⏳
       ├── 5.4.1  能力注册 ⏳
       ├── 5.4.2  能力搜索 ⏳
       ├── 5.4.3  能力调用代理 ⏳
       ├── 5.4.4  按次计费 ⏳
       └── 5.4.5  SLA 监控 ⏳

□ 5.5  API 扩展 ⏳
       ├── 5.5.1  路由: /api/markets/info/* ⏳
       ├── 5.5.2  路由: /api/markets/tasks/* ⏳
       ├── 5.5.3  路由: /api/markets/capabilities/* ⏳
       └── 5.5.4  CLI: clawtoken market ⏳

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎯 v0.2.0 里程碑
   Agent 可以: 发布/购买信息、发布/接受任务、注册/调用能力
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

### Phase 6: Protocol Layer - 合约模块 (Week 13-16)

对应规范文档：
- `docs/implementation/protocol-spec.md`
- `docs/implementation/event-schemas/contracts.md`
- `docs/SERVICE_CONTRACTS.md`
- `docs/SMART_CONTRACTS.md`
- `docs/implementation/economics.md`

```
□ 6.1  Contract Module (@clawtoken/protocol/contracts) ⏳
       ├── 6.1.1  合约数据结构 ⏳
       ├── 6.1.2  合约状态机 ⏳
       ├── 6.1.3  合约创建 ⏳
       ├── 6.1.4  多方签署 ⏳
       ├── 6.1.5  合约存储 (P2P) ⏳
       └── 6.1.6  单元测试 ⏳

□ 6.2  Escrow (托管) ⏳
       ├── 6.2.1  托管账户创建 ⏳
       ├── 6.2.2  资金锁定 ⏳
       ├── 6.2.3  条件释放 ⏳
       ├── 6.2.4  部分释放 ⏳
       └── 6.2.5  超时处理 ⏳

□ 6.3  Milestone (里程碑) ⏳
       ├── 6.3.1  里程碑定义 ⏳
       ├── 6.3.2  里程碑提交 ⏳
       ├── 6.3.3  里程碑审核 ⏳
       ├── 6.3.4  阶段付款 ⏳
       └── 6.3.5  里程碑拒绝与重做 ⏳

□ 6.4  Dispute (争议) ⏳
       ├── 6.4.1  争议发起 ⏳
       ├── 6.4.2  证据提交 ⏳
       ├── 6.4.3  和解机制 ⏳
       ├── 6.4.4  仲裁流程 (简化版) ⏳
       └── 6.4.5  争议解决 ⏳

□ 6.5  API 扩展 ⏳
       ├── 6.5.1  路由: /api/contracts/* ⏳
       ├── 6.5.2  路由: /api/wallet/escrow/* ⏳
       └── 6.5.3  CLI: clawtoken contract ⏳

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎯 v0.3.0 里程碑
   Agent 可以: 创建/签署合约、托管支付、里程碑管理、争议处理
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

### Phase 7: SDK 开发 (Week 17-18)

对应规范文档：
- `docs/api/openapi.yaml`
- `docs/implementation/tasks/min-api-draft.md`
- `docs/implementation/tasks/api-errors.md`

```
□ 7.1  TypeScript SDK (@clawtoken/sdk) ⏳
       ├── 7.1.1  HTTP Client 封装 ⏳
       ├── 7.1.2  类型定义 (从 OpenAPI 生成) ⏳
       ├── 7.1.3  Wallet 模块 ⏳
       ├── 7.1.4  Identity 模块 ⏳
       ├── 7.1.5  Markets 模块 ⏳
       ├── 7.1.6  Contracts 模块 ⏳
       ├── 7.1.7  Reputation 模块 ⏳
       ├── 7.1.8  便利方法 (waitForSync 等) ⏳
       └── 7.1.9  SDK 测试 ⏳

□ 7.2  Python SDK (clawtoken-sdk) ⏳
       ├── 7.2.1  HTTP Client 封装 ⏳
       ├── 7.2.2  类型定义 (dataclass) ⏳
       ├── 7.2.3  各模块封装 ⏳
       └── 7.2.4  SDK 测试 ⏳

□ 7.3  示例代码 ⏳
       ├── 7.3.1  examples/python-agent/ ⏳
       ├── 7.3.2  examples/nodejs-agent/ ⏳
       └── 7.3.3  examples/shell-scripts/ ⏳
```

---

### Phase 8: 文档与发布 (Week 19-20)

对应规范文档：
- `docs/implementation/rollout.md`
- `docs/implementation/testing-plan.md`

```
□ 8.1  文档完善 ⏳
       ├── 8.1.1  README.md ⏳
       ├── 8.1.2  快速开始指南 ⏳
       ├── 8.1.3  API 文档 (从 OpenAPI 生成) ⏳
       ├── 8.1.4  SDK 文档 ⏳
       ├── 8.1.5  部署指南 ⏳
       └── 8.1.6  FAQ ⏳

□ 8.2  发布准备 ⏳
       ├── 8.2.1  npm 发布 (@clawtoken/node, @clawtoken/sdk) ⏳
       ├── 8.2.2  PyPI 发布 (clawtoken-sdk) ⏳
       ├── 8.2.3  GitHub Releases (二进制) ⏳
       ├── 8.2.4  Docker 镜像 ⏳
       └── 8.2.5  官网 / Landing Page ⏳

□ 8.3  测试网部署 ⏳
       ├── 8.3.1  Bootstrap 节点 ⏳
       ├── 8.3.2  测试网水龙头 ⏳
       └── 8.3.3  监控面板 ⏳

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🎯 v1.0.0 里程碑: 正式发布
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

### Phase 9: DAO 治理 (Week 21+)

对应规范文档：
- `docs/implementation/protocol-spec.md`
- `docs/DAO.md`
- `docs/implementation/economics.md`

```
□ 9.1  DAO Module (@clawtoken/protocol/dao) ⏳
       ├── 9.1.1  提案数据结构 ⏳
       ├── 9.1.2  投票权计算 ⏳
       ├── 9.1.3  提案创建 ⏳
       ├── 9.1.4  投票机制 ⏳
       ├── 9.1.5  委托投票 ⏳
       ├── 9.1.6  时间锁 ⏳
       ├── 9.1.7  提案执行 ⏳
       └── 9.1.8  国库管理 ⏳

□ 9.2  API 扩展 ⏳
       ├── 9.2.1  路由: /api/dao/* ⏳
       └── 9.2.2  CLI: clawtoken dao ⏳
```

---

### 进度跟踪

| Phase | 描述 | 预计周期 | 状态 |
|-------|------|----------|------|
| 0 | 基础设施 | Week 0 | ✅ 已完成（CI/CD 部分完成） |
| 1 | Core Layer | Week 1-2 | ⏳ 进行中 |
| 2 | Identity + Wallet | Week 3-4 | ⏳ |
| 3 | Interface (MVP) | Week 5-6 | ⏳ |
| 4 | Reputation | Week 7-8 | ⏳ |
| 5 | Markets | Week 9-12 | ⏳ |
| 6 | Contracts | Week 13-16 | ⏳ |
| 7 | SDK | Week 17-18 | ⏳ |
| 8 | 文档与发布 | Week 19-20 | ⏳ |
| 9 | DAO | Week 21+ | ⏳ |

---

## 相关文档

- [AGENT_RUNTIME.md](AGENT_RUNTIME.md) — 节点运行与 API 调用
- [ARCHITECTURE.md](ARCHITECTURE.md) — 整体架构设计
- [DECENTRALIZATION.md](DECENTRALIZATION.md) — 去中心化路线图

---

*最后更新: 2026年2月4日*
